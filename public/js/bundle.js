!function(e){function n(r){if(t[r])return t[r].exports;var o=t[r]={exports:{},id:r,loaded:!1};return e[r].call(o.exports,o,o.exports,n),o.loaded=!0,o.exports}var t={};return n.m=e,n.c=t,n.p="",n(0)}([function(e,n,t){angular.module("ChatApp",["ngAnimate","ngMaterial","luegg.directives","toastr"]),t(1),t(2),t(3),t(4),t(5),t(6)},function(e,n){angular.module("ChatApp").controller("ChatController",["$scope","$http","$mdDialog","RequestService","ConversationService","userIdsToStringFilter","toastr",function(e,n,t,r,o,s,a){function i(n){e.currentlySelectedTab=n}function u(){r.getUserInfo().then(function(n){e.loggedIn=!0,e.currentUserData=n.data,r.getRegisteredUsers().then(function(n){M(e.registeredUsers,n.data)})},function(n){e.errorText="Failed to get user data : "+n.status+" - "+n.statusText})}function c(){r.getGithubLoginPath().then(function(e){window.location.href=e.data.uri})}function f(n){r.getConversations().then(function(t){var r=o.updateCurrentConversations(e.currentConversations,t.data);e.unseenMessages=r.unseenMessages,e.unseenConversations=r.unseenConversations,n||(e.unseenMessages.forEach(function(n){n.message.userid!==e.currentUserData.id&&e.currentlySelectedTab!==o.getIndexOfConversation(e.currentConversations,n.conversationId)&&(U(n),o.addToUnreadMessageCounter(C(n.conversationId),1))}),e.unseenConversations.forEach(function(e){x(e)}))},function(n){e.errorText="Failed to fetch conversations : "+n.status+" - "+n.statusText})}function d(n,t){n&&r.postGuestLogin(n,t).then(function(n){e.loadUserInfo(),e.errorText=""},function(n){e.errorText="Failed to login as guest : "+n.status+" - "+n.statusText})}function l(n,t){n.push(e.currentUserData.id),r.postStartConversation(n,t).then(function(n){e.refreshConversations()},function(n){e.errorText="Failed to start conversation : "+n.status+" - "+n.statusText})}function g(n,t){r.postAddUserToConversation(n,t).then(function(n){e.refreshConversations()},function(n){e.errorText="Failed to add user to conversation : "+n.status+" - "+n.statusText})}function v(n){r.postLeaveConversation(n).then(function(n){e.refreshConversations()},function(n){e.errorText="Failed to leave conversation : "+n.status+" - "+n.statusText})}function p(n,t){r.putUpdateConversationDetails(n,t).then(function(n){e.refreshConversations()},function(n){e.errorText="Failed to rename conversation : "+n.status+" - "+n.statusText})}function h(n){r.postSendMessage(n,e.newMessageValues[n]).then(function(t){e.newMessageValues[n]="",e.refreshConversations()},function(n){e.errorText="Failed to send message : "+n.status+" - "+n.statusText})}function m(n){return _.find(e.registeredUsers,function(e){return e.id===n})}function C(n){return _.find(e.currentConversations,function(e){return e.id===n})}function x(e){e.name?a.info(y(e),"Added to the conversation"):a.info(y(e),"Added to a conversation with")}function U(e){var n=m(e.message.userid).name;a.info(e.message.text,"Message from "+n)}function T(e,n,t){o.showRenameConversationDialog(e,t).then(function(e){p(n,e)})}function b(n){var t,r=C(n);if(r.name)t=r.name;else{var o=r.userids.filter(function(n){return e.currentUserData.id!==n});t=s(o,e.registeredUsers,!0)}return r.unreadMessages&&(t+=" ("+r.unreadMessages+")"),t}function M(e,n){for(var t=0;t<n.length;t++)e[t]&&e[t].id===e[t].id||e.splice(t,0,n[t])}function y(e){return b(e.id)}e.guestLogin=d,e.githubLogin=c,e.loadUserInfo=u,e.startConversation=l,e.addUserToConversation=g,e.leaveConversation=v,e.refreshConversations=f,e.sendMessage=h,e.getUserFromId=m,e.setClearedForConversationMessages=o.setClearedForConversationMessages,e.clearUnreadMessageCounter=o.clearUnreadMessageCounter,e.renameConversation=T,e.getConversationLabelFromId=b,e.getConversationLabel=y,e.setSelectedTab=i,e.newMessageValues={},e.currentUserData={},e.registeredUsers=[],e.nameInputBox="",e.avatarUrlInputBox="http://s.mtgprice.com/images/unknown.png",e.currentConversations=[],e.errorText="",e.unseenMessages=[],e.loggedIn=!1,e.currentlySelectedTab=0,angular.element(document).ready(function(){e.loadUserInfo(),e.refreshConversations(!0),setInterval(function(){u(),f()},1e3)})}])},function(e,n){angular.module("ChatApp").service("RequestService",["$http",function(e){function n(){return e.get("api/user")}function t(){return e.get("api/users")}function r(){return e.get("/api/oauth/uri")}function o(){return e.get("api/conversations")}function s(n,t){return e({method:"POST",url:"/api/newGuest",data:{name:n,avatarUrl:t}})}function a(n,t){return e({method:"POST",url:"/api/newConversation",data:{userIds:n,conversationName:t}})}function i(n,t){return e({method:"POST",url:"api/addUserToConversation",data:{userid:n,conversationid:t}})}function u(n){return e({method:"POST",url:"api/leaveConversation",data:{conversationid:n}})}function c(n,t){return e({method:"POST",url:"/api/newMessage",data:{conversationId:n,messageText:t}})}function f(n,t){return e({method:"PUT",url:"api/updateConversationDetails",data:{conversationid:n,conversationName:t}})}var d=this;d.getUserInfo=n,d.getRegisteredUsers=t,d.getConversations=o,d.getGithubLoginPath=r,d.postGuestLogin=s,d.postStartConversation=a,d.postLeaveConversation=u,d.postSendMessage=c,d.postAddUserToConversation=i,d.putUpdateConversationDetails=f}])},function(e,n){angular.module("ChatApp").config(["$mdThemingProvider",function(e){e.theme("default").primaryPalette("indigo").accentPalette("deep-orange").backgroundPalette("grey")}])},function(e,n){angular.module("ChatApp").service("ConversationService",["$mdDialog",function(e){function n(e,n,t){e.forEach(function(e){e.id===n&&e.messages.forEach(function(e){e.cleared=t})})}function t(e,n){function t(e,n){for(var t=0;t<n.messages.length;t++)if(!e.messages[t]||e.messages[t].id!==n.messages[t].id){e.messages.splice(t,0,n.messages[t]);var r={message:n.messages[t],conversationId:n.id};s.push(r)}}function r(e,n){_.isEqual(e.userids,n.userids)||(e.userids=n.userids)}var o,s=[],a=[],i=0,u=0;for(i=0;i<n.length;i++){for(o=!1,u=0;u<e.length;u++)if(n[i].id===e[u].id){t(e[u],n[i]),r(e[u],n[i]),e[i].name=n[i].name,o=!0;break}o||(e[i]?e.splice(i,0,n[i]):e.push(n[i]),a.push(e[i]))}for(i=0;i<e.length;i++){for(o=!1,u=0;u<n.length;u++)if(e[i].id===n[u].id){o=!0;break}o||(e.splice(i,1),i--)}return{unseenMessages:s,unseenConversations:a}}function r(e,n){e.unreadMessages?e.unreadMessages+=n:e.unreadMessages=n}function o(e){e.unreadMessages=0}function s(n,t){var r=e.prompt().title("Name the conversation").initialValue(t).ariaLabel("Conversation name").targetEvent(n).ok("Done").cancel("Cancel");return e.show(r)}function a(e,n){return e.findIndex(function(e){return e.id===n})}this.setClearedForConversationMessages=n,this.updateCurrentConversations=t,this.showRenameConversationDialog=s,this.addToUnreadMessageCounter=r,this.clearUnreadMessageCounter=o,this.getIndexOfConversation=a}])},function(e,n){angular.module("ChatApp").filter("userIdsToString",function(){return function(e,n,t){function r(e){return _.find(n,function(n){return n.id===e})}if(0===e.length)return"No one";if(0===n.length)return"Loading ...";if(1===e.length)return r(e[0]).name;if(t){var o=r(e[0]).name;return o+=" and ",o+=e.length-1,o+=" other",e.length>2&&(o+="s"),o}var s=e.map(function(e){return r(e).name});return s.slice(0,s.length-1).join(", ").concat(" and "+s[s.length-1])}})},function(e,n,t){var r=t(7);"string"==typeof r&&(r=[[e.id,r,""]]);t(9)(r,{});r.locals&&(e.exports=r.locals)},function(e,n,t){n=e.exports=t(8)(),n.push([e.id,".conversation-window{height:600px}",""])},function(e,n){e.exports=function(){var e=[];return e.toString=function(){for(var e=[],n=0;n<this.length;n++){var t=this[n];t[2]?e.push("@media "+t[2]+"{"+t[1]+"}"):e.push(t[1])}return e.join("")},e.i=function(n,t){"string"==typeof n&&(n=[[null,n,""]]);for(var r={},o=0;o<this.length;o++){var s=this[o][0];"number"==typeof s&&(r[s]=!0)}for(o=0;o<n.length;o++){var a=n[o];"number"==typeof a[0]&&r[a[0]]||(t&&!a[2]?a[2]=t:t&&(a[2]="("+a[2]+") and ("+t+")"),e.push(a))}},e}},function(e,n,t){function r(e,n){for(var t=0;t<e.length;t++){var r=e[t],o=g[r.id];if(o){o.refs++;for(var s=0;s<o.parts.length;s++)o.parts[s](r.parts[s]);for(;s<r.parts.length;s++)o.parts.push(c(r.parts[s],n))}else{for(var a=[],s=0;s<r.parts.length;s++)a.push(c(r.parts[s],n));g[r.id]={id:r.id,refs:1,parts:a}}}}function o(e){for(var n=[],t={},r=0;r<e.length;r++){var o=e[r],s=o[0],a=o[1],i=o[2],u=o[3],c={css:a,media:i,sourceMap:u};t[s]?t[s].parts.push(c):n.push(t[s]={id:s,parts:[c]})}return n}function s(e,n){var t=h(),r=x[x.length-1];if("top"===e.insertAt)r?r.nextSibling?t.insertBefore(n,r.nextSibling):t.appendChild(n):t.insertBefore(n,t.firstChild),x.push(n);else{if("bottom"!==e.insertAt)throw new Error("Invalid value for parameter 'insertAt'. Must be 'top' or 'bottom'.");t.appendChild(n)}}function a(e){e.parentNode.removeChild(e);var n=x.indexOf(e);n>=0&&x.splice(n,1)}function i(e){var n=document.createElement("style");return n.type="text/css",s(e,n),n}function u(e){var n=document.createElement("link");return n.rel="stylesheet",s(e,n),n}function c(e,n){var t,r,o;if(n.singleton){var s=C++;t=m||(m=i(n)),r=f.bind(null,t,s,!1),o=f.bind(null,t,s,!0)}else e.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(t=u(n),r=l.bind(null,t),o=function(){a(t),t.href&&URL.revokeObjectURL(t.href)}):(t=i(n),r=d.bind(null,t),o=function(){a(t)});return r(e),function(n){if(n){if(n.css===e.css&&n.media===e.media&&n.sourceMap===e.sourceMap)return;r(e=n)}else o()}}function f(e,n,t,r){var o=t?"":r.css;if(e.styleSheet)e.styleSheet.cssText=U(n,o);else{var s=document.createTextNode(o),a=e.childNodes;a[n]&&e.removeChild(a[n]),a.length?e.insertBefore(s,a[n]):e.appendChild(s)}}function d(e,n){var t=n.css,r=n.media;if(r&&e.setAttribute("media",r),e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}function l(e,n){var t=n.css,r=n.sourceMap;r&&(t+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(r))))+" */");var o=new Blob([t],{type:"text/css"}),s=e.href;e.href=URL.createObjectURL(o),s&&URL.revokeObjectURL(s)}var g={},v=function(e){var n;return function(){return"undefined"==typeof n&&(n=e.apply(this,arguments)),n}},p=v(function(){return/msie [6-9]\b/.test(window.navigator.userAgent.toLowerCase())}),h=v(function(){return document.head||document.getElementsByTagName("head")[0]}),m=null,C=0,x=[];e.exports=function(e,n){n=n||{},"undefined"==typeof n.singleton&&(n.singleton=p()),"undefined"==typeof n.insertAt&&(n.insertAt="bottom");var t=o(e);return r(t,n),function(e){for(var s=[],a=0;a<t.length;a++){var i=t[a],u=g[i.id];u.refs--,s.push(u)}if(e){var c=o(e);r(c,n)}for(var a=0;a<s.length;a++){var u=s[a];if(0===u.refs){for(var f=0;f<u.parts.length;f++)u.parts[f]();delete g[u.id]}}}};var U=function(){var e=[];return function(n,t){return e[n]=t,e.filter(Boolean).join("\n")}}()}]);